"use strict";var setPage=function(e){var t=$(".pages .page").hide(),a=t.filter("."+e);a.show(),a.hasClass("page-blue")?($(document.body).addClass("background-blue"),$(".game-steps").hide()):($(document.body).removeClass("background-blue"),$(".game-steps").show())},numbers=["aucune","une","deux","trois","quatre","cinq","six","sept","huit","neuf"],points=0,maxPoints=0;$(".start-action, .continue-action").on("click",function(e){e.preventDefault(),setPage("page-select"),points=0,maxPoints=0}),$(".share-img").on("click",function(e){e.preventDefault();var t="J'ai fais "+points+" points sur "+maxPoints+" ! Test tes connaissances en politique:",a=location.href;window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(t)+"&url="+encodeURIComponent(a),"_blank")}),$(".navbar-brand").on("click",function(e){e.preventDefault(),setPage("page-start")}),setPage("page-start"),window.jsonp_response=function(e){var t=$(".card-game"),a=$('.game-template [data-template="card"]'),n=($(".btn-game-submit"),$(".game-task")),s=$(".game-steps"),r=$(".flash-next-step"),i=$(".theme-list"),o=0,c=$(".select-choice .select-left"),p=$(".select-choice .select-right");$.each(e.themes,function(e,t){var a=$("<li></li>").text(t.label);a.attr("data-theme",e),i.append(a),(o++%2?c:p).append($("<li></li>").append($("<a></a>").addClass("choice").data("choice",e).text(t.label).on("click",function(e){e.preventDefault(),setPage("page-game"),d("environnement_ecologie",0)})))}),$(".choice-random").on("click",function(e){e.preventDefault(),setPage("page-game"),d("environnement_ecologie",0)});var d=function o(c,p){var d=e.themes[c].steps[p],l=e.themes[c].steps.length,u=[],h=[];i.find(".active").removeClass("active"),i.find('[data-theme="'+c+'"]').addClass("active"),s.empty(),n.show();for(var g=0;g<l;g++){var f=$("<a></a>").attr("href","#").text("Étape "+(g+1));f.on("click",function(e){return e.preventDefault()});var m=$("<li></li>").append(f);p===g&&m.addClass("active"),s.append(m)}t.empty(),$.each(d.candidates,function(e,n){var s=a.clone();s.find(".card-title").text(n.label),s.find(".card-thumbnail").attr("src",n.img),u.push(s),h.push({title:n.program.title,content:n.program.content,slot:s}),s.appendTo(t)}),$.each(u,function(e,t){var a=h.splice(Math.floor(Math.random()*h.length),1)[0];t.find(".card-program").data("correct-parent",a.slot);var n=t.find(".card-text");n.append($("<h5></h5>").text(a.title)),$.each(a.content,function(e,t){n.append($("<p></p>").text(t))})});var v=t.find(".card-candidate"),x=t.find(".card-program"),b=0;x.each(function(e,t){$(t).data("original-parent",$(t).parent());var a=$(t).outerHeight();a>b&&(b=a)}),x.each(function(e,t){$(t).find(".card-program-inner").outerHeight(b)});var C=Draggable.create(".card-game .card-program",{type:"x,y",onDragStart:function(e){var t=$(this.target);t.hasClass("card-program")&&t.parent().hasClass("card-candidate")&&t.parent().removeClass("card-filled")},onDrag:function(e){var t=this;v.each(function(a,n){Draggable.hitTest(n,e)&&n!==t.target?$(n).addClass("card-drag-hover"):$(n).removeClass("card-drag-hover")})},onDragEnd:function(e){var t=this,a=!1,s=$(this.target);if(v.each(function(n,s){a||!Draggable.hitTest(s,e)||s===t.target||$(s).hasClass("card-filled")||(a=$(s)),$(s).removeClass("card-drag-hover")}),a?(a.append(s),a.addClass("card-filled"),TweenLite.set(s,{clearProps:"all"})):(s.parent().hasClass("card-candidate")&&(s.parent().removeClass("card-filled"),s.appendTo(s.data("original-parent"))),TweenLite.set(s,{clearProps:"all"})),!v.filter(":not(.card-filled)").length){$.each(C,function(e,t){return t.kill()}),n.hide(),v.each(function(e,t){var a=$(t),n=a.find(".card-program"),s=a.closest(".card-slot"),r=n.data("correct-parent");n.appendTo(n.data("correct-parent")),maxPoints++,s.is(r)?(a.addClass("card-state-success"),points++):a.addClass("card-state-error")}),p<l-1?(r.find(".flash-action-message").text("Passer à l’étape "+(p+2)),r.find("a").one("click",function(e){e.preventDefault(),r.hide(),o(c,p+1)})):(r.find(".flash-action-message").text("Continuer"),r.find("a").one("click",function(e){e.preventDefault(),r.hide(),$(".points-count").empty().append([$("<span></span>").text("Vous totalisez "),$("<span></span>").addClass("text-highlight").text(points),$("<span></span>").text(points>=2?" points sur ":"point sur ").append(maxPoints)]),setPage("page-points")}));var i=["Vous avez obtenu"];points>=numbers.length?i.push(points.toString()):i.push(numbers[points]),points>=2?i.push("bonnes réponses sur"):i.push("bonne réponse sur"),maxPoints>=numbers.length?i.push(maxPoints.toString()):i.push(numbers[maxPoints]),r.find(".flash-text").text(i.join(" ")),r.show()}}})}};
//# sourceMappingURL=app.js.map
